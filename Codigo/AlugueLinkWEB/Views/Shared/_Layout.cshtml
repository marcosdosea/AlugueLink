@using Microsoft.AspNetCore.Identity
@using AlugueLinkWEB.Areas.Identity.Data

@inject SignInManager<UsuarioIdentity> SignInManager
@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString() ?? string.Empty;
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString() ?? string.Empty;
    var isAuthenticated = SignInManager.IsSignedIn(User);
}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - AlugueLink</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/viacep.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/AlugueLinkWEB.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root { 
            /* Light Theme */ 
            --color-body-bg:#ffffff; 
            --color-surface:#ffffff; 
            --color-surface-alt:#f8f9fa; 
            --color-text:#212529; 
            --color-text-muted:#6c757d; 
            --color-border:#dee2e6; 
            --color-primary:#0d6efd; 
            --color-primary-hover:#0a58ca; 
            --color-danger:#dc3545; 
            --color-success:#198754; 
            --color-warning:#ffc107; 
            --color-info:#0dcaf0;
            --color-sidebar-bg:#f8f9fa; 
            --color-topbar-bg:#ffffff; 
            --color-hero-gradient:linear-gradient(135deg,#0d6efd,#0a58ca); 
            --color-scrollbar:#c1c7ce; 
        }
        .dark-mode { 
            --color-body-bg:#0d1117; 
            --color-surface:#161b22; 
            --color-surface-alt:#21262d; 
            --color-text:#e6edf3; 
            --color-text-muted:#7d8590; 
            --color-border:#30363d; 
            --color-primary:#58a6ff; 
            --color-primary-hover:#388bfd; 
            --color-danger:#f85149; 
            --color-success:#3fb950; 
            --color-warning:#d29922; 
            --color-info:#58a6ff;
            --color-sidebar-bg:#0d1117; 
            --color-topbar-bg:#161b22; 
            --color-hero-gradient:linear-gradient(135deg,#1f2328,#2d333b); 
            --color-scrollbar:#6e7681; 
        }
        html,body{height:100%;margin:0;padding:0;} 
        body{background:var(--color-body-bg)!important;color:var(--color-text)!important;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;transition:background-color 0.3s ease, color 0.3s ease;} 
        *{transition:background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;}
        a{color:var(--color-primary);} 
        a:hover{color:var(--color-primary-hover);} 
        .topbar{background:var(--color-topbar-bg)!important;border-color:var(--color-border)!important;} 
        .sidebar{width:250px;background:var(--color-sidebar-bg)!important;color:var(--color-text)!important;display:flex;flex-direction:column;border-color:var(--color-border)!important;} 
        .sidebar .nav-link{color:var(--color-text)!important;border-radius:.5rem;padding:.55rem .85rem;font-weight:500;} 
        .sidebar .nav-link.active,.sidebar .nav-link:hover{background:var(--color-surface-alt)!important;color:var(--color-primary)!important;} 
        .sidebar .nav-section{font-size:.65rem;letter-spacing:.08em;font-weight:600;color:var(--color-text-muted)!important;} 
        .brand-name{font-size:1.05rem;color:var(--color-text)!important;} 
        .page-title{color:var(--color-text)!important;} 
        .card,.auth-card{background:var(--color-surface)!important;border:1px solid var(--color-border)!important;} 
        .card .card-title{color:var(--color-text)!important;} 
        .card .card-text{color:var(--color-text)!important;}
        .card .card-body{background:var(--color-surface)!important;}
        .text-muted{color:var(--color-text-muted)!important;} 
        .form-control,.form-select,.input-group-text{background:var(--color-surface-alt)!important;border:1px solid var(--color-border)!important;color:var(--color-text)!important;} 
        .form-control:focus{border-color:var(--color-primary)!important;box-shadow:0 0 0 .15rem rgba(88,166,255,.25)!important;} 
        .input-group-text{color:var(--color-text-muted)!important;} 
        .btn-primary{background:var(--color-primary)!important;border-color:var(--color-primary)!important;color:#ffffff!important;} 
        .btn-primary:hover{background:var(--color-primary-hover)!important;border-color:var(--color-primary-hover)!important;color:#ffffff!important;} 
        .btn-outline-light{color:var(--color-text)!important;border-color:var(--color-border)!important;background:transparent!important;} 
        .dark-mode .btn-outline-light{color:#e6edf3!important;border-color:#30363d!important;} 
        .btn-outline-light:hover{background:var(--color-surface-alt)!important;color:var(--color-text)!important;border-color:var(--color-border)!important;} 
        .badge.bg-secondary{background:var(--color-text-muted)!important;color:var(--color-surface)!important;} 
        .welcome-hero,.hero-section{background:var(--color-hero-gradient)!important;color:#ffffff!important;} 
        .dropdown-menu{background:var(--color-surface)!important;border:1px solid var(--color-border)!important;} 
        .dropdown-item{color:var(--color-text)!important;} 
        .dropdown-item:hover{background:var(--color-surface-alt)!important;color:var(--color-text)!important;} 
        .dropdown-item.text-danger:hover{background:var(--color-danger)!important;color:#ffffff!important;} 
        .theme-toggle{position:fixed;bottom:1rem;right:1rem;z-index:1100;background:var(--color-surface)!important;border:1px solid var(--color-border)!important;padding:.5rem .75rem;border-radius:2rem;box-shadow:0 .25rem .75rem rgba(0,0,0,.15);} 
        .theme-toggle label{color:var(--color-text)!important;font-size:.75rem;cursor:pointer;margin:0;}
        .form-check-input{cursor:pointer;} 
        .form-check-input:checked{background-color:var(--color-primary)!important;border-color:var(--color-primary)!important;} 
        .sidebar-footer{border-top:1px solid var(--color-border)!important;color:var(--color-text-muted)!important;} 
        ::-webkit-scrollbar{width:10px;} 
        ::-webkit-scrollbar-track{background:var(--color-body-bg);} 
        ::-webkit-scrollbar-thumb{background:var(--color-scrollbar);border-radius:6px;} 
        ::-webkit-scrollbar-thumb:hover{background:var(--color-primary-hover);} 
        .app.without-sidebar .sidebar{display:none;} 
        body.no-auth .topbar{background:transparent!important;border:0!important;} 
        body.no-auth .page-title{display:none;} 
        .auth-wrapper{background:var(--color-body-bg)!important;min-height:100vh;} 
        .auth-card .card-header{background:var(--color-surface)!important;border-bottom:1px solid var(--color-border)!important;color:var(--color-text)!important;} 
        .auth-card .card-body{background:var(--color-surface)!important;color:var(--color-text)!important;} 
        .auth-card .card-footer{background:var(--color-surface)!important;border-top:1px solid var(--color-border)!important;color:var(--color-text)!important;} 
        .alert{border:1px solid var(--color-border)!important;background:var(--color-surface-alt)!important;color:var(--color-text)!important;} 
        .alert-success{background:rgba(57,185,80,.15)!important;color:var(--color-success)!important;border-color:var(--color-success)!important;} 
        .alert-warning{background:rgba(210,153,34,.15)!important;color:var(--color-warning)!important;border-color:var(--color-warning)!important;} 
        .alert-info{background:rgba(88,166,255,.15)!important;color:var(--color-info)!important;border-color:var(--color-info)!important;} 
        .alert-danger{background:rgba(248,81,73,.15)!important;color:var(--color-danger)!important;border-color:var(--color-danger)!important;}
        .landing-page .card{transition:transform .3s ease,background .3s ease;} 
        .landing-page .card:hover{background:var(--color-surface-alt)!important;transform:translateY(-5px);} 
        .text-primary{color:var(--color-primary)!important;}
        .text-success{color:var(--color-success)!important;}
        .text-warning{color:var(--color-warning)!important;}
        .text-info{color:var(--color-info)!important;}
        .text-danger{color:var(--color-danger)!important;}
        .text-secondary{color:var(--color-text-muted)!important;}
        .content{background:var(--color-body-bg)!important;}
        .main{background:var(--color-body-bg)!important;}
        h1,h2,h3,h4,h5,h6{color:var(--color-text)!important;}
        p{color:var(--color-text)!important;}
        ul li{color:var(--color-text)!important;}
        strong{color:var(--color-text)!important;}
        @@media (max-width:992px){.sidebar{width:220px;}} 
        @@media (max-width:768px){.theme-toggle{right:1rem;bottom:1rem;}}
    </style>
</head>
<body class="@(isAuthenticated ? string.Empty : "no-auth")">
    <div class="app d-flex @(isAuthenticated ? string.Empty : "without-sidebar")">
        @if (isAuthenticated)
        {
            <aside class="sidebar border-end">
                <div class="brand d-flex align-items-center p-3">
                    <i class="fas fa-home text-primary me-2" style="font-size: 1.5rem;"></i>
                    <span class="brand-name fw-bold">AlugueLink</span>
                </div>
                <nav class="nav flex-column px-3">
                    <a class="nav-link d-flex align-items-center @((currentController == "Home" && currentAction == "Index") ? "active" : string.Empty)" asp-area="" asp-controller="Home" asp-action="Index">
                        <span class="icon me-2"><i class="fas fa-home"></i></span>Início
                    </a>
                    <div class="nav-section mt-3 mb-2 px-2">GESTÃO DE IMÓVEIS</div>
                    <a class="nav-link d-flex align-items-center @((currentController == "Imovel" && currentAction == "Create") ? "active" : string.Empty)" asp-controller="Imovel" asp-action="Create">
                        <span class="icon me-2"><i class="fas fa-plus-circle"></i></span>Cadastrar Imóvel
                    </a>
                    <a class="nav-link d-flex align-items-center @((currentController == "Imovel" && currentAction == "Index") ? "active" : string.Empty)" asp-controller="Imovel" asp-action="Index">
                        <span class="icon me-2"><i class="fas fa-building"></i></span>Meus Imóveis
                    </a>
                    <div class="nav-section mt-3 mb-2 px-2">GESTÃO DE INQUILINOS</div>
                    <a class="nav-link d-flex align-items-center @((currentController == "Locatario" && currentAction == "Create") ? "active" : string.Empty)" asp-controller="Locatario" asp-action="Create">
                        <span class="icon me-2"><i class="fas fa-user-plus"></i></span>Cadastrar Inquilino
                    </a>
                    <a class="nav-link d-flex align-items-center @((currentController == "Locatario" && currentAction == "Index") ? "active" : string.Empty)" asp-controller="Locatario" asp-action="Index">
                        <span class="icon me-2"><i class="fas fa-users"></i></span>Meus Inquilinos
                    </a>
                    <div class="nav-section mt-3 mb-2 px-2">GESTÃO DE ALUGUÉIS</div>
                    <a class="nav-link d-flex align-items-center @((currentController == "Aluguel" && currentAction == "Create") ? "active" : string.Empty)" asp-controller="Aluguel" asp-action="Create">
                        <span class="icon me-2"><i class="fas fa-file-contract"></i></span>Novo Aluguel
                    </a>
                    <a class="nav-link d-flex align-items-center @((currentController == "Aluguel" && currentAction == "Index") ? "active" : string.Empty)" asp-controller="Aluguel" asp-action="Index">
                        <span class="icon me-2"><i class="fas fa-clipboard-list"></i></span>Meus Aluguéis
                    </a>
                </nav>
                <div class="sidebar-footer small p-3 mt-auto">© @DateTime.Now.Year AlugueLink</div>
            </aside>
        }
        <div class="main flex-grow-1 d-flex flex-column">
            <header class="topbar border-bottom">
                <div class="container-fluid d-flex align-items-center justify-content-between py-3">
                    <h1 class="page-title h5 m-0">@ViewData["Title"]</h1>
                    <div><partial name="_LoginPartial" /></div>
                </div>
            </header>
            <main role="main" class="content container-fluid py-4">@RenderBody()</main>
        </div>
    </div>
    <div class="theme-toggle">
        <div class="form-check form-switch m-0 d-flex align-items-center">
            <input class="form-check-input me-2" type="checkbox" id="themeSwitch" />
            <label class="form-check-label d-flex align-items-center" for="themeSwitch">
                <i class="fas fa-moon me-1"></i><span id="themeLabel">Escuro</span>
            </label>
        </div>
    </div>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const themeSwitch=document.getElementById('themeSwitch');const themeLabel=document.getElementById('themeLabel');const savedTheme=localStorage.getItem('aluguelink-theme')||'light';function setTheme(t){document.body.classList.toggle('dark-mode',t==='dark');themeLabel.textContent=t==='dark'?'Claro':'Escuro';}setTheme(savedTheme);themeSwitch.checked=savedTheme==='dark';themeSwitch.addEventListener('change',e=>{const t=e.target.checked?'dark':'light';localStorage.setItem('aluguelink-theme',t);setTheme(t);});
    </script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
